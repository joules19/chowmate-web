(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{81492:function(e,s,t){Promise.resolve().then(t.bind(t,36683))},99376:function(e,s,t){"use strict";var r=t(35475);t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}}),t.o(r,"useServerInsertedHTML")&&t.d(s,{useServerInsertedHTML:function(){return r.useServerInsertedHTML}})},36683:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(57437),i=t(2265),E=t(99376),n=t(24294);function o(){let e=(0,E.useRouter)();return(0,i.useEffect)(()=>{(async()=>{try{if(!await n.e.initializeAuth()){e.replace("/login?redirect=/admin/dashboard");return}if(!n.e.hasAdminAccess()){e.replace("/unauthorized");return}e.replace("/admin/dashboard")}catch(s){console.error("Admin access check failed:",s),e.replace("/login?redirect=/admin/dashboard")}})()},[e]),(0,r.jsx)("div",{className:"min-h-screen bg-background-primary flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-primary-500 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-text-secondary",children:"Checking admin access..."})]})})}},8226:function(e,s,t){"use strict";var r,i,E,n;t.d(s,{MN:function(){return o},uU:function(){return r},y3:function(){return i}}),(E=r||(r={})).SUPER_ADMIN="SuperAdmin",E.ADMIN="Admin",E.MODERATOR="Moderator",E.SUPPORT="Support",(n=i||(i={})).VIEW_DASHBOARD="VIEW_DASHBOARD",n.VIEW_USERS="VIEW_USERS",n.CREATE_USER="CREATE_USER",n.EDIT_USER="EDIT_USER",n.DELETE_USER="DELETE_USER",n.SUSPEND_USER="SUSPEND_USER",n.VIEW_VENDORS="VIEW_VENDORS",n.APPROVE_VENDOR="APPROVE_VENDOR",n.REJECT_VENDOR="REJECT_VENDOR",n.SUSPEND_VENDOR="SUSPEND_VENDOR",n.EDIT_VENDOR="EDIT_VENDOR",n.DELETE_VENDOR="DELETE_VENDOR",n.VIEW_RIDERS="VIEW_RIDERS",n.APPROVE_RIDER="APPROVE_RIDER",n.REJECT_RIDER="REJECT_RIDER",n.SUSPEND_RIDER="SUSPEND_RIDER",n.EDIT_RIDER="EDIT_RIDER",n.DELETE_RIDER="DELETE_RIDER",n.TRACK_RIDER="TRACK_RIDER",n.VIEW_ORDERS="VIEW_ORDERS",n.EDIT_ORDER="EDIT_ORDER",n.CANCEL_ORDER="CANCEL_ORDER",n.REFUND_ORDER="REFUND_ORDER",n.ASSIGN_RIDER="ASSIGN_RIDER",n.VIEW_ANALYTICS="VIEW_ANALYTICS",n.EXPORT_REPORTS="EXPORT_REPORTS",n.VIEW_SETTINGS="VIEW_SETTINGS",n.EDIT_SETTINGS="EDIT_SETTINGS",n.MANAGE_PERMISSIONS="MANAGE_PERMISSIONS",n.VIEW_AUDIT_LOGS="VIEW_AUDIT_LOGS",n.MANAGE_SYSTEM="MANAGE_SYSTEM";let o={SuperAdmin:Object.values(i),Admin:["VIEW_DASHBOARD","VIEW_USERS","CREATE_USER","EDIT_USER","SUSPEND_USER","VIEW_VENDORS","APPROVE_VENDOR","REJECT_VENDOR","SUSPEND_VENDOR","EDIT_VENDOR","VIEW_RIDERS","APPROVE_RIDER","REJECT_RIDER","SUSPEND_RIDER","EDIT_RIDER","TRACK_RIDER","VIEW_ORDERS","EDIT_ORDER","CANCEL_ORDER","ASSIGN_RIDER","VIEW_ANALYTICS","EXPORT_REPORTS","VIEW_SETTINGS","VIEW_AUDIT_LOGS"],Moderator:["VIEW_DASHBOARD","VIEW_USERS","VIEW_VENDORS","APPROVE_VENDOR","REJECT_VENDOR","VIEW_RIDERS","APPROVE_RIDER","REJECT_RIDER","VIEW_ORDERS","EDIT_ORDER","ASSIGN_RIDER","VIEW_ANALYTICS"],Support:["VIEW_DASHBOARD","VIEW_USERS","VIEW_VENDORS","VIEW_RIDERS","VIEW_ORDERS","EDIT_ORDER"]}},51034:function(e,s,t){"use strict";t.d(s,{Nv:function(){return o}});var r=t(83464),i=t(24294);let E=r.Z.create({baseURL:"http://localhost:8080",timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});E.interceptors.request.use(e=>{let s=i.e.getToken();return s&&(e.headers.Authorization="Bearer ".concat(s)),e},e=>(console.error("Request interceptor error:",e),Promise.reject(e))),E.interceptors.response.use(e=>e,async e=>{var s,t,r;let n=e.config;if((null===(s=e.response)||void 0===s?void 0:s.status)===401){if(!(null==n?void 0:n._retry)){n&&(n._retry=!0);try{if(await i.e.refreshToken()&&n){let e=i.e.getToken();if(e)return n.headers.Authorization="Bearer ".concat(e),E(n)}}catch(e){console.error("Token refresh failed:",e)}}i.e.logout();{let e=window.location.pathname;e.includes("/login")||(window.location.href="/login?redirect=".concat(encodeURIComponent(e)))}}return(null===(t=e.response)||void 0===t?void 0:t.status)===403&&console.error("Access forbidden - insufficient permissions"),(null===(r=e.response)||void 0===r?void 0:r.status)&&e.response.status>=500&&console.error("Server error - please try again later"),Promise.reject(e)}),s.ZP=E;let n=e=>{let{data:s}=e;if("success"in s){if(!s.success)throw Error(s.message||"API request failed");return s.data}if(200!==s.statusCode)throw Error(s.message||"API request failed");let t=s.data;return t&&"object"==typeof t&&"items"in t?{items:t.items,pageNumber:t.pageNumber,pageSize:t.pageSize,totalCount:t.totalCount}:t},o=async e=>{try{let s=await e();return n(s)}catch(e){if(r.Z.isAxiosError(e)){var s,t;throw Error((null===(t=e.response)||void 0===t?void 0:null===(s=t.data)||void 0===s?void 0:s.message)||e.message)}throw e}}},24294:function(e,s,t){"use strict";t.d(s,{e:function(){return n}});var r=t(19157),i=t(8226),E=t(51034);class n{static async login(e,s){try{let t=(await E.ZP.post("/api/account/auth/admin-signin",{email:e,password:s})).data.data;if(console.log("Login response:",t),!t.accessToken||!t.user)throw Error("Invalid login response - missing required data");return this.setToken(t.accessToken),this.setRefreshToken(t.refreshToken||""),this.setTokenExpiry(t.expiration||""),this.setUser(t.user),r.$.setUserPermissions({role:t.user.roles[0],permissions:t.user.permissions}),t}catch(e){throw console.error("Login error:",e),e}}static logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),localStorage.removeItem(this.TOKEN_EXPIRY_KEY),r.$.clearPermissions()}static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}static setRefreshToken(e){localStorage.setItem(this.REFRESH_TOKEN_KEY,e)}static getTokenExpiry(){return localStorage.getItem(this.TOKEN_EXPIRY_KEY)}static setTokenExpiry(e){localStorage.setItem(this.TOKEN_EXPIRY_KEY,e)}static isTokenExpired(){let e=this.getTokenExpiry();return!e||new Date(e)<=new Date}static getUser(){{let e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}}static setUser(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}static isAuthenticated(){return!!this.getToken()}static async refreshToken(){let e=this.getRefreshToken();if(!e)return!1;try{let s=(await E.ZP.post("/api/auth/refresh",{refreshToken:e})).data.data;if(s.accessToken)return this.setToken(s.accessToken),this.setRefreshToken(s.refreshToken||""),this.setTokenExpiry(s.expiration||""),!0;return!1}catch(e){return console.error("Token refresh failed:",e),this.logout(),!1}}static async validateToken(){if(!this.getToken())return!1;try{return(await E.ZP.post("/api/auth/validate")).data.data.valid}catch(e){return console.error("Token validation failed:",e),!1}}static async initializeAuth(){let e=this.getToken(),s=this.getUser();return e&&s?(r.$.setUserPermissions({role:s.roles[0],permissions:s.permissions}),s):null}static hasAdminAccess(){let e=this.getUser();return!!e&&e.roles.some(e=>[i.uU.SUPER_ADMIN,i.uU.ADMIN,i.uU.MODERATOR].includes(e))}}n.TOKEN_KEY="authToken",n.REFRESH_TOKEN_KEY="refreshToken",n.USER_KEY="authUser",n.TOKEN_EXPIRY_KEY="tokenExpiry"},19157:function(e,s,t){"use strict";t.d(s,{$:function(){return i}});var r=t(8226);class i{static setUserPermissions(e){this.userPermissions=e}static getUserPermissions(){return this.userPermissions}static hasPermission(e){return!!this.userPermissions&&this.userPermissions.permissions.includes(e)}static hasRole(e){return!!this.userPermissions&&this.userPermissions.role===e}static hasAnyRole(e){return!!this.userPermissions&&e.includes(this.userPermissions.role)}static hasAnyPermission(e){return!!this.userPermissions&&e.some(e=>this.userPermissions.permissions.includes(e))}static canAccess(e){return!!this.userPermissions&&(Array.isArray(e)?e:[e]).every(e=>this.userPermissions.permissions.includes(e))}static getPermissionsForRole(e){return r.MN[e]||[]}static isAdmin(){return this.hasAnyRole([r.uU.SUPER_ADMIN,r.uU.ADMIN])}static isSuperAdmin(){return this.hasRole(r.uU.SUPER_ADMIN)}static canManageUsers(){return this.hasAnyPermission([r.y3.CREATE_USER,r.y3.EDIT_USER,r.y3.DELETE_USER,r.y3.SUSPEND_USER])}static canManageVendors(){return this.hasAnyPermission([r.y3.APPROVE_VENDOR,r.y3.REJECT_VENDOR,r.y3.SUSPEND_VENDOR,r.y3.EDIT_VENDOR,r.y3.DELETE_VENDOR])}static canManageRiders(){return this.hasAnyPermission([r.y3.APPROVE_RIDER,r.y3.REJECT_RIDER,r.y3.SUSPEND_RIDER,r.y3.EDIT_RIDER,r.y3.DELETE_RIDER])}static canManageOrders(){return this.hasAnyPermission([r.y3.EDIT_ORDER,r.y3.CANCEL_ORDER,r.y3.REFUND_ORDER,r.y3.ASSIGN_RIDER])}static clearPermissions(){this.userPermissions=null}}i.userPermissions=null}},function(e){e.O(0,[464,971,117,744],function(){return e(e.s=81492)}),_N_E=e.O()}]);